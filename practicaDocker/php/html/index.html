<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión de Alumnos</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 0 10px; }
    .card { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
    input, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #eee; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>

  <h1>Gestión de Alumnos</h1>

  <!-- FORMULARIO PARA INSERTAR ALUMNO -->
  <div class="card">
    <h3>Añadir Alumno</h3>

    <form id="form-add">
      <input type="text" id="nombre" placeholder="Nombre" required>
      <input type="number" id="psp" placeholder="Nota PSP" required>
      <input type="number" id="ad" placeholder="Nota AD" required>
      <input type="number" id="ciber" placeholder="Nota Ciberseguridad" required>
      <input type="number" id="ingles" placeholder="Nota Ingles" required>
      <input type="number" id="interfaces" placeholder="Nota Interfaces" required>
      <button type="submit">Guardar</button>
    </form>

    <div id="status-add"></div>
  </div>

  <!-- LISTADO DE ALUMNOS -->
  <div class="card">
    <h3>
      Listado de Alumnos 
      <button onclick="listar()" style="width: auto; float: right; padding: 5px 10px;">
        Actualizar
      </button>
    </h3>

    <table id="tabla-alumnos">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>PSP</th>
          <th>AD</th>
          <th>Ciber</th>
          <th>Inglés</th>
          <th>Interfaces</th>
        </tr>
      </thead>
      <tbody id="tbody-alumnos"></tbody>
    </table>
  </div>

  <script>
    // ====================
    //   LISTAR ALUMNOS
    // ====================
    async function listar() {
      const tbody = document.getElementById('tbody-alumnos');
      tbody.innerHTML = '<tr><td colspan="7">Cargando...</td></tr>';

      try {
        const res = await fetch('listar.php');
        const data = await res.json();

        tbody.innerHTML = data.map(a =>
          `<tr>
            <td>${a.id}</td>
            <td>${a.nombre}</td>
            <td>${a.psp}</td>
            <td>${a.ad}</td>
            <td>${a.ciber}</td>
            <td>${a.ingles}</td>
            <td>${a.interfaces}</td>
          </tr>`
        ).join('');

      } catch (error) {
        tbody.innerHTML = '<tr><td colspan="7">Error al cargar</td></tr>';
      }
    }

    // ====================
    //   INSERTAR ALUMNO
    // ====================
    document.getElementById('form-add').addEventListener('submit', async (e) => {
      e.preventDefault();

      const params = new URLSearchParams({
        nombre: document.getElementById('nombre').value,
        psp: document.getElementById('psp').value,
        ad: document.getElementById('ad').value,
        ciber: document.getElementById('ciber').value,
        ingles: document.getElementById('ingles').value,
        interfaces: document.getElementById('interfaces').value
      });

      const status = document.getElementById('status-add');

      try {
        const res = await fetch('insertar.php', {
          method: 'POST',
          body: params
        });

        const data = await res.json();

        if (data.resultado === "OK") {
          status.textContent = "Guardado correctamente";
          document.getElementById('form-add').reset();
          listar();
        } else {
          status.textContent = "ERROR: " + data.detalle;
        }

      } catch (e) {
        status.textContent = "Error al guardar";
      }
    });

    // Cargar lista al abrir la página
    listar();
  </script>

</body>
</html>
